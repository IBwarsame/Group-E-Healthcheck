{% load static %}

<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Set New Password</title>
        <link
            rel="stylesheet"
            href="{% static 'healthcheck/css/styles.css' %}"
        />
        <script
            src="https://kit.fontawesome.com/b4269277b2.js"
            crossorigin="anonymous"
        ></script>
    </head>
    <body>
        <div class="container">
            <div class="login-container">
                <img
                    src="{% static 'healthcheck/images/sky.png' %}"
                    alt="Sky Logo"
                    class="logo"
                />
                <h1>Set New Password</h1>

                <form method="post">
                    {% csrf_token %} 
                    {% if form.errors %}
                    <div class="error-message">
                        {% for field in form %} 
                            {% for error in field.errors %}
                                <p>{{ error }}</p>
                            {% endfor %} 
                        {% endfor %}
                    </div>
                    {% endif %}

                    <div class="input-group">
                        <label for="{{ form.new_password1.id_for_label }}">New Password</label>
                        {{ form.new_password1 }}
                        <div class="password-strength">
                            <div class="strength-meter"></div>
                        </div>
                        <div class="password-requirements">
                            <div class="requirement" data-requirement="length">
                                <span class="check-icon"><i class="fa-solid fa-check"></i></span>
                                <span class="cross-icon"><i class="fa-solid fa-xmark"></i></span>
                                At least 8 characters
                            </div>
                            <div class="requirement" data-requirement="number">
                                <span class="check-icon"><i class="fa-solid fa-check"></i></span>
                                <span class="cross-icon"><i class="fa-solid fa-xmark"></i></span>
                                Contains a number
                            </div>
                            <div class="requirement" data-requirement="uppercase">
                                <span class="check-icon"><i class="fa-solid fa-check"></i></span>
                                <span class="cross-icon"><i class="fa-solid fa-xmark"></i></span>
                                Contains uppercase letter
                            </div>
                            <div class="requirement" data-requirement="lowercase">
                                <span class="check-icon"><i class="fa-solid fa-check"></i></span>
                                <span class="cross-icon"><i class="fa-solid fa-xmark"></i></span>
                                Contains lowercase letter
                            </div>
                            <div class="requirement" data-requirement="special">
                                <span class="check-icon"><i class="fa-solid fa-check"></i></span>
                                <span class="cross-icon"><i class="fa-solid fa-xmark"></i></span>
                                Contains special character
                            </div>
                        </div>
                    </div>

                    <div class="input-group">
                        <label for="{{ form.new_password2.id_for_label }}">Confirm New Password</label>
                        {{ form.new_password2 }}
                    </div>

                    <div class="login-button-group">
                        <button type="submit" class="btn">
                            Reset Password
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const passwordInput = document.getElementById("{{ form.new_password1.auto_id }}");
                const requirements = {
                    length: (str) => str.length >= 8,
                    number: (str) => /[0-9]/.test(str),
                    uppercase: (str) => /[A-Z]/.test(str),
                    lowercase: (str) => /[a-z]/.test(str),
                    special: (str) => /[^A-Za-z0-9]/.test(str),
                };

                const strengthMeter = document.querySelector(".strength-meter");

                passwordInput.addEventListener("input", function (e) {
                    const password = e.target.value;
                    let metRequirements = 0;

                    // Check each requirement
                    Object.entries(requirements).forEach(
                        ([requirement, validateFunc]) => {
                            const metRequirement = validateFunc(password);
                            const requirementElement = document.querySelector(
                                `[data-requirement="${requirement}"]`
                            );

                            if (metRequirement) {
                                requirementElement.classList.add("met");
                                metRequirements++;
                            } else {
                                requirementElement.classList.remove("met");
                            }
                        }
                    );

                    // Update strength meter
                    const strength =
                        (metRequirements / Object.keys(requirements).length) *
                        100;
                    strengthMeter.style.width = `${strength}%`;

                    if (strength <= 25) {
                        strengthMeter.style.backgroundColor = "#ff4d4d";
                    } else if (strength <= 50) {
                        strengthMeter.style.backgroundColor = "#ffd700";
                    } else if (strength <= 75) {
                        strengthMeter.style.backgroundColor = "#90EE90";
                    } else {
                        strengthMeter.style.backgroundColor = "#28a745";
                    }
                });
            });
        </script>
    </body>
</html>
